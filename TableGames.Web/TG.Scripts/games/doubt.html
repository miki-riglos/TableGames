<style>
    .tg-doubt-playercups, .tg-doubt-usergame {
        margin-top: 20px;
    }

        .tg-doubt-usergame .tab-content {
            padding: 15px;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-radius: 0 0 5px 5px;
        }

    .tg-doubt-usergame-actionbutton {
        width: 100%;
    }

    .tg-doubt-dice {
        display: inline-block;
        width: 35px;
        height: 35px;
    }

    .tg-dial {
        display: inline-block;
        width: 40px;
    }
</style>

<template id="doubtTemplate">
    <div class="tg-doubt">
        <div class="row">
            <div class="col-xs-4">
                Quantity: <span data-bind="text: quantity"></span>
            </div>
            <div class="col-xs-3" data-bind="template: { name: 'doubtDiceTemplate', data: dice }"></div>
            <div class="col-xs-5" data-bind="if: isEnded">
                <!-- ko with: table.stats()[table.stats().length - 1] -->
                <span class="badge pull-right">
                    <span class="glyphicon" data-bind="css: winnerNames.length ? 'glyphicon-ok': 'glyphicon-remove'" aria-hidden="true"></span>
                    <span data-bind="text: endActionName"></span>
                </span>
                <!-- /ko -->
                Count: <span data-bind="text: actualQuantity"></span>
            </div>
        </div>

        <div class="tg-doubt-playercups" data-bind="foreach: { data: playerCups, as: 'cup' }">
            <div class="row">
                <div class="col-xs-4">
                    <span class="pull-right" data-bind="if: $parent.isEnded">
                        <!-- ko with: $parent.table.stats()[$parent.table.stats().length - 1] -->
                        <span class="glyphicon glyphicon-minus-sign" data-bind="visible: cup.playerName === diceLoserName" aria-hidden="true"></span>
                        <span class="glyphicon glyphicon-plus-sign" data-bind="visible: cup.playerName === diceWinnerName" aria-hidden="true"></span>
                        <!-- /ko -->
                    </span>
                    <span class="" data-bind="text: cup.playerName"></span>
                </div>

                <!-- ko if: playerName !== $root.authentication.userName() || $parent.isEnded() -->
                <div class="col-xs-8" data-bind="template: { name: 'doubtDiceTemplate', foreach: cup.dices }"></div>
                <!-- /ko -->

                <!-- ko if: playerName === $root.authentication.userName() && !$parent.isEnded() -->
                <!-- ko with: $parent.userGame -->
                <div class="col-xs-8" data-bind="template: { name: 'doubtDiceTemplate', foreach: dices }"></div>
                <!-- /ko -->
                <!-- /ko -->
            </div>
        </div>


        <div class="tg-doubt-usergame" data-bind="with: userGame">
            <!-- action nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a data-bind="attr: { 'href': '#' + $parent.table.room.clientId + '_action_bet' }" aria-controls="home" role="tab" data-toggle="tab">Bet</a>
                </li>
                <li role="presentation">
                    <a data-bind="attr: { 'href': '#' + $parent.table.room.clientId + '_action_doubt' }" aria-controls="profile" role="tab" data-toggle="tab">Doubt</a>
                </li>
                <li role="presentation">
                    <a data-bind="attr: { 'href': '#' + $parent.table.room.clientId + '_action_match' }" aria-controls="messages" role="tab" data-toggle="tab">Match</a>
                </li>
            </ul>

            <!-- action tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane fade in active" data-bind="attr: { 'id': $parent.table.room.clientId + '_action_bet' }">
                    <div class="row">
                        <div class="col-xs-4">
                            Quantity: <span data-bind="text: $parent.actions.bet.quantity"></span>
                            <!-- ko template: { name: 'doubtDialTemplate', data: $parent.actions.bet.quantity.dial } --><!-- /ko -->
                        </div>
                        <div class="col-xs-4">
                            <!-- ko template: { name: 'doubtDiceTemplate', data: $parent.actions.bet.dice } --><!-- /ko -->
                            <!-- ko template: { name: 'doubtDialTemplate', data: $parent.actions.bet.dice.dial } --><!-- /ko -->
                        </div>
                        <div class="col-xs-4">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" data-bind="checked: $parent.actions.bet.rollOthers, enable: $parent.table.isUserTurn" /> Roll others
                                </label>
                            </div>
                            <button type="button" class="btn btn-primary tg-doubt-usergame-actionbutton" data-bind="click: $parent.actions.bet.execute, enable: $parent.table.isUserTurn">Bet</button>
                        </div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane fade" data-bind="attr: { 'id': $parent.table.room.clientId + '_action_doubt' }">
                    <div class="row">
                        <div class="col-xs-offset-8 col-xs-4">
                            <button type="button" class="btn btn-primary tg-doubt-usergame-actionbutton" data-bind="click: $parent.actions.doubt.execute, enable: $parent.table.isUserTurn() && $parent.hasBet()">Doubt</button>
                        </div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane fade" data-bind="attr: { 'id': $parent.table.room.clientId + '_action_match' }">
                    <div class="row">
                        <div class="col-xs-offset-8 col-xs-4">
                            <button type="button" class="btn btn-primary tg-doubt-usergame-actionbutton" data-bind="click: $parent.actions.match.execute, enable: $parent.table.isUserTurn() && $parent.hasBet() && $parent.actions.match.isUserAllowed()">Match</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</template>

<template id="doubtDiceTemplate">
    <div class="tg-doubt-dice">
        <svg viewBox="0 0 128 128">
            <rect width="128" height="128" data-bind="attr: { fill: color }" rx="8" />
            <rect width="112" height="112" data-bind="attr: { fill: matchingColor }" x="8" y="8" rx="4" />

            <circle cx="30" cy="30" r="10" data-bind="attr: { fill: color }, visible: value() >= 2" />
            <circle cx="98" cy="30" r="10" data-bind="attr: { fill: color }, visible: value() >= 4" />

            <circle cx="30" cy="64" r="10" data-bind="attr: { fill: color }, visible: value() === 6" />
            <circle cx="64" cy="64" r="10" data-bind="attr: { fill: color }, visible: [1, 3, 5].indexOf(value()) !== -1" />
            <circle cx="98" cy="64" r="10" data-bind="attr: { fill: color }, visible: value() === 6" />

            <circle cx="30" cy="98" r="10" data-bind="attr: { fill: color }, visible: value() >= 4" />
            <circle cx="98" cy="98" r="10" data-bind="attr: { fill: color }, visible: value() >= 2" />
        </svg>
    </div>
</template>

<template id="doubtDialTemplate">
    <div class="tg-dial">
        <button type="button" class="btn btn-default" data-bind="click: up.execute, enable: up.enable">
            <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>
        </button>
        <button type="button" class="btn btn-default" data-bind="click: down.execute, enable: down.enable">
            <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>
        </button>
    </div>
</template>

<template id="doubtStatsTemplate">
    <div class="panel panel-default collapse" data-bind="attr: { 'id': room.clientId + '_stats' }">
        <div class="panel-heading">
            <span>Stats</span>
        </div>
        <table class="table table-condensed">
            <thead>
                <tr>
                    <th>
                        <span>#</span>
                    </th>
                    <!-- ko foreach: { data: playerNames, as: 'playerName' } -->
                    <th>
                        <span data-bind="text: playerName, css: { 'tg-active': playerName === $parent.activePlayerName() }"></span>
                    </th>
                    <!-- /ko -->
                </tr>
            </thead>
            <tbody data-bind="foreach: { data: stats, as: 'gameStats' }">
                <tr>
                    <td>
                        <span data-bind="text: $index() + 1"></span>
                    </td>
                    <!-- ko foreach: { data: $parent.playerNames, as: 'playerName' } -->
                    <td>
                        <span class="glyphicon glyphicon-minus-sign" data-bind="visible: playerName === gameStats.diceLoserName" aria-hidden="true"></span>
                        <span class="glyphicon glyphicon-plus-sign" data-bind="visible: playerName === gameStats.diceWinnerName" aria-hidden="true"></span>
                        <span class="glyphicon glyphicon-ok" data-bind="visible: gameStats.winnerNames.indexOf(playerName) > -1" aria-hidden="true"></span>
                    </td>
                    <!-- /ko -->
                </tr>
            </tbody>
        </table>
    </div>
</template>
